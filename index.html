<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Projections Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #e9ecef;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 500;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group input, .form-group select {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .tier-section {
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background: white;
        }

        .tier-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .tier-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .remove-tier {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s ease;
        }

        .remove-tier:hover {
            background: #c82333;
        }

        .add-tier {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .add-tier:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .calculate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .results {
            margin-top: 40px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
            text-align: center;
        }

        .summary-card h3 {
            font-size: 1.1rem;
            color: #6c757d;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .summary-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .summary-card.positive .value {
            color: #28a745;
        }

        .summary-card.negative .value {
            color: #dc3545;
        }

        .summary-card.warning .value {
            color: #ffc107;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background: #007bff;
            color: white;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            margin-left: 5px;
        }

        .tooltip-text {
            visibility: hidden;
            width: 300px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 8px;
            padding: 12px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            line-height: 1.4;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }

            .tooltip-text {
                width: 250px;
                margin-left: -125px;
                left: 50%;
                right: auto;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Financial Projections Dashboard</h1>
            <p>Model your subscription business with advanced financial analytics</p>
        </div>

        <div class="content">
            <!-- Subscription Tiers Section -->
            <div class="section">
                <h2 class="section-title">
                    Subscription Tiers
                    <div class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Define your subscription plans with pricing, quotas, and user behavior patterns. Each tier represents a different service level with its own pricing and usage limits.</span>
                    </div>
                </h2>
                <div id="subscription-tiers"></div>
                <button class="add-tier" onclick="addTier()">+ Add Subscription Tier</button>
            </div>

            <!-- Cost Structure Section -->
            <div class="section">
                <h2 class="section-title">
                    Cost Structure
                    <div class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Define your business costs including fixed monthly expenses, variable usage costs, customer acquisition costs, and one-time startup expenses.</span>
                    </div>
                </h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>
                            Monthly Fixed Expenses ($)
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Regular monthly costs that don't change with usage, such as salaries, rent, software subscriptions, and other operational expenses.</span>
                            </div>
                        </label>
                        <input type="number" id="fixed-expenses" value="10000" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            Variable Cost - Flat Fee ($)
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Base monthly fee for your service provider (e.g., API costs, hosting) that includes a certain amount of usage before overage charges apply.</span>
                            </div>
                        </label>
                        <input type="number" id="flat-fee" value="1000" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            Included Minutes (Monthly)
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Number of minutes included in your flat fee before overage charges begin. This is your total monthly allowance across all users.</span>
                            </div>
                        </label>
                        <input type="number" id="included-minutes" value="100000" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            Overage Cost per Minute ($)
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Additional cost charged for each minute of usage beyond your included allowance. This creates variable costs that scale with usage.</span>
                            </div>
                        </label>
                        <input type="number" id="overage-cost" value="0.02" step="0.001" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            Customer Acquisition Cost (CAC) per User ($)
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Average cost to acquire one new customer, including marketing spend, sales costs, advertising, and promotional expenses.</span>
                            </div>
                        </label>
                        <input type="number" id="cac-per-user" value="50" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            One-time Startup Costs ($)
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Initial expenses required to launch your business, such as development costs, legal fees, initial marketing, equipment, and setup expenses.</span>
                            </div>
                        </label>
                        <input type="number" id="startup-costs" value="25000" min="0">
                    </div>
                </div>
            </div>

            <!-- Funding & Projections Section -->
            <div class="section">
                <h2 class="section-title">
                    Funding & Projections
                    <div class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Set your available funding and projection timeline to understand cash flow, burn rate, and runway analysis.</span>
                    </div>
                </h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>
                            Available Funding ($)
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Total capital available to fund operations, including investment, loans, or personal funds. This determines how long you can operate before needing additional funding.</span>
                            </div>
                        </label>
                        <input type="number" id="available-funding" value="500000" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            Start Date
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">The beginning date for your financial projections. All calculations will start from this month.</span>
                            </div>
                        </label>
                        <input type="month" id="start-date" value="2024-01">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            Projection Period (Months)
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">How many months into the future to project. Longer periods help with strategic planning but may be less accurate due to market uncertainties.</span>
                            </div>
                        </label>
                        <input type="number" id="num-months" value="24" min="1" max="60">
                    </div>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateProjections()">Calculate Financial Projections</button>

            <!-- Results Section -->
            <div id="results" class="results hidden">
                <div class="section">
                    <h2 class="section-title">
                        Key Metrics Summary
                        <div class="tooltip">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">Critical business metrics that determine your financial health, growth trajectory, and funding requirements.</span>
                        </div>
                    </h2>
                    <div class="summary-grid" id="summary-cards"></div>
                </div>

                <div class="section">
                    <h2 class="section-title">
                        Financial Analysis Charts
                        <div class="tooltip">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">Visual representation of your financial projections showing revenue growth, cost structure, cash flow, and funding utilization over time.</span>
                        </div>
                    </h2>
                    <div class="charts-grid">
                        <div class="chart-container">
                            <h3 class="chart-title">
                                Financial Overview
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Shows your revenue growth, total expenses, and net cash flow over time. The gap between revenue and expenses indicates profitability.</span>
                                </div>
                            </h3>
                            <canvas id="financial-chart"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h3 class="chart-title">
                                Expense Breakdown
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Breakdown of your costs into fixed expenses (consistent monthly costs) and variable expenses (costs that change with usage and growth).</span>
                                </div>
                            </h3>
                            <canvas id="expenses-chart"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h3 class="chart-title">
                                Burn Rate Analysis
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Monthly cash burn (negative cash flow) and cumulative burn over time. High burn rates indicate faster funding consumption.</span>
                                </div>
                            </h3>
                            <canvas id="burn-rate-chart"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h3 class="chart-title">
                                Cash Flow with Funding
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Your actual cash position after accounting for funding support. Shows when you'll need additional funding or achieve profitability.</span>
                                </div>
                            </h3>
                            <canvas id="cash-flow-chart"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h3 class="chart-title">
                                Funding Utilization
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Monthly funding drawdown and remaining funding balance. Helps track your runway and plan for future funding rounds.</span>
                                </div>
                            </h3>
                            <canvas id="funding-chart"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h3 class="chart-title">
                                User Growth by Tier
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Growth trajectory of users in each subscription tier, showing how your customer base evolves over time.</span>
                                </div>
                            </h3>
                            <canvas id="users-chart"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h3 class="chart-title">
                                Usage & Overage Analysis
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Total platform usage and overage minutes that exceed your included allowance, driving additional variable costs.</span>
                                </div>
                            </h3>
                            <canvas id="usage-chart"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h3 class="chart-title">
                                Customer Acquisition Costs
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Monthly spending on customer acquisition and cumulative CAC investment. Shows the cost of growth and marketing efficiency.</span>
                                </div>
                            </h3>
                            <canvas id="cac-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { VariableCostStructure, SubscriptionTier, FinancialProjection } from './financial_projections.js';

        let tierCount = 0;
        let charts = {};

        // Initialize with default tiers
        window.addEventListener('load', function() {
            addTier('Basic', 60, 29, 100, 0.05, 0.15, 0.7);
            addTier('Pro', 180, 99, 50, 0.03, 0.20, 0.8);
            addTier('Enterprise', 600, 299, 20, 0.02, 0.10, 0.9);
        });

        window.addTier = function(name = '', dailyQuota = 60, price = 29, users = 50, churn = 0.05, growth = 0.15, usage = 0.8) {
            tierCount++;
            const tierId = `tier-${tierCount}`;
            
            const tierHtml = `
                <div class="tier-section" id="${tierId}">
                    <div class="tier-header">
                        <span class="tier-name">Subscription Tier ${tierCount}</span>
                        <button class="remove-tier" onclick="removeTier('${tierId}')">Remove</button>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>
                                Tier Name
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">A descriptive name for this subscription tier (e.g., Basic, Pro, Enterprise) used for identification in reports and charts.</span>
                                </div>
                            </label>
                            <input type="text" class="tier-name-input" value="${name}" placeholder="e.g., Basic, Pro, Enterprise">
                        </div>
                        <div class="form-group">
                            <label>
                                Daily Minute Quota
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Maximum minutes each user in this tier can use per day. Monthly usage is calculated as daily quota × 30 days × usage rate.</span>
                                </div>
                            </label>
                            <input type="number" class="daily-quota" value="${dailyQuota}" min="0">
                        </div>
                        <div class="form-group">
                            <label>
                                Monthly Price ($)
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Monthly subscription fee charged to each user in this tier. This is your primary revenue source per user.</span>
                                </div>
                            </label>
                            <input type="number" class="monthly-price" value="${price}" min="0">
                        </div>
                        <div class="form-group">
                            <label>
                                Initial User Count
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Number of users you expect to start with in this tier at the beginning of your projection period.</span>
                                </div>
                            </label>
                            <input type="number" class="initial-users" value="${users}" min="0">
                        </div>
                        <div class="form-group">
                            <label>
                                Monthly Churn Rate (%)
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Percentage of users who cancel their subscription each month. Lower churn rates indicate better customer retention and product-market fit.</span>
                                </div>
                            </label>
                            <input type="number" class="churn-rate" value="${churn * 100}" min="0" max="100" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>
                                Monthly Growth Rate (%)
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Percentage of new users acquired each month relative to current user base. Higher growth rates accelerate revenue but also increase CAC costs.</span>
                                </div>
                            </label>
                            <input type="number" class="growth-rate" value="${growth * 100}" min="0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>
                                Usage Rate (%)
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Percentage of their daily quota that users typically consume. Most users don't use 100% of their allowance, so this creates more realistic usage projections.</span>
                                </div>
                            </label>
                            <input type="number" class="usage-rate" value="${usage * 100}" min="0" max="100" step="1">
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('subscription-tiers').insertAdjacentHTML('beforeend', tierHtml);
        };

        window.removeTier = function(tierId) {
            const tierElement = document.getElementById(tierId);
            if (tierElement) {
                tierElement.remove();
            }
        };

        window.calculateProjections = function() {
            // Collect subscription tiers
            const tiers = [];
            const tierElements = document.querySelectorAll('.tier-section');
            
            tierElements.forEach(tierElement => {
                const name = tierElement.querySelector('.tier-name-input').value || 'Unnamed';
                const dailyQuota = parseInt(tierElement.querySelector('.daily-quota').value) || 0;
                const price = parseFloat(tierElement.querySelector('.monthly-price').value) || 0;
                const initialUsers = parseInt(tierElement.querySelector('.initial-users').value) || 0;
                const churnRate = parseFloat(tierElement.querySelector('.churn-rate').value) / 100 || 0;
                const growthRate = parseFloat(tierElement.querySelector('.growth-rate').value) / 100 || 0;
                const usageRate = parseFloat(tierElement.querySelector('.usage-rate').value) / 100 || 0;
                
                tiers.push(new SubscriptionTier(name, dailyQuota, price, initialUsers, churnRate, growthRate, usageRate));
            });

            // Collect cost structure
            const fixedExpenses = parseFloat(document.getElementById('fixed-expenses').value) || 0;
            const flatFee = parseFloat(document.getElementById('flat-fee').value) || 0;
            const includedMinutes = parseInt(document.getElementById('included-minutes').value) || 0;
            const overageCost = parseFloat(document.getElementById('overage-cost').value) || 0;
            const cacPerUser = parseFloat(document.getElementById('cac-per-user').value) || 0;
            const startupCosts = parseFloat(document.getElementById('startup-costs').value) || 0;

            // Collect funding and projection settings
            const availableFunding = parseFloat(document.getElementById('available-funding').value) || 0;
            const startDate = document.getElementById('start-date').value;
            const numMonths = parseInt(document.getElementById('num-months').value) || 12;

            // Create projection
            const variableCostStructure = new VariableCostStructure(flatFee, includedMinutes, overageCost);
            const monthlyFixedExpenses = { total: fixedExpenses };
            
            const projection = new FinancialProjection(
                tiers,
                monthlyFixedExpenses,
                variableCostStructure,
                startDate,
                numMonths,
                availableFunding,
                cacPerUser,
                startupCosts
            );

            const results = projection.calculateProjections();
            displayResults(results, tiers);
        };

        function displayResults(results, tiers) {
            document.getElementById('results').classList.remove('hidden');
            
            // Create summary cards
            createSummaryCards(results);
            
            // Create charts
            createCharts(results, tiers);
        }

        function createSummaryCards(results) {
            const summaryContainer = document.getElementById('summary-cards');
            
            // Calculate key metrics
            const totalRevenue = results.TotalRevenue[results.TotalRevenue.length - 1];
            const totalExpenses = results.TotalExpenses[results.TotalExpenses.length - 1];
            const finalCashFlow = results.MonthlyCashFlow[results.MonthlyCashFlow.length - 1];
            const maxBurnRate = Math.max(...results.BurnRate);
            const totalFundingUsed = results.FundingDrawdown.reduce((sum, val) => sum + val, 0);
            const remainingFunding = results.RemainingFunding[results.RemainingFunding.length - 1];

            const cards = [
                {
                    title: 'Break-Even Month',
                    value: results.BreakEvenMonth ? `Month ${results.BreakEvenMonth}` : 'Not Achieved',
                    class: results.BreakEvenMonth ? 'positive' : 'negative',
                    tooltip: 'The first month when your business generates positive cash flow without relying on external funding.'
                },
                {
                    title: 'Peak Monthly Burn Rate',
                    value: `$${maxBurnRate.toLocaleString()}`,
                    class: 'negative',
                    tooltip: 'Highest monthly cash burn rate during the projection period. This represents your maximum monthly funding requirement.'
                },
                {
                    title: 'Total Funding Used',
                    value: `$${totalFundingUsed.toLocaleString()}`,
                    class: totalFundingUsed > 0 ? 'warning' : 'positive',
                    tooltip: 'Total amount of funding consumed during the projection period to cover negative cash flows.'
                },
                {
                    title: 'Remaining Funding',
                    value: `$${remainingFunding.toLocaleString()}`,
                    class: remainingFunding > 50000 ? 'positive' : remainingFunding > 0 ? 'warning' : 'negative',
                    tooltip: 'Funding remaining at the end of the projection period. Low values indicate need for additional funding.'
                },
                {
                    title: 'Final Monthly Revenue',
                    value: `$${totalRevenue.toLocaleString()}`,
                    class: 'positive',
                    tooltip: 'Monthly recurring revenue at the end of the projection period, showing your revenue growth trajectory.'
                },
                {
                    title: 'Final Monthly Cash Flow',
                    value: `$${finalCashFlow.toLocaleString()}`,
                    class: finalCashFlow > 0 ? 'positive' : 'negative',
                    tooltip: 'Net cash flow in the final month. Positive values indicate profitability and sustainable operations.'
                }
            ];

            // Add funding exhaustion warning if applicable
            if (results.FundingExhausted) {
                cards.unshift({
                    title: 'Funding Exhausted',
                    value: `Month ${results.FundingExhaustedMonth}`,
                    class: 'negative',
                    tooltip: 'The month when available funding is completely depleted. You will need additional funding or revenue growth to continue operations.'
                });
            }

            summaryContainer.innerHTML = cards.map(card => `
                <div class="summary-card ${card.class}">
                    <h3>
                        ${card.title}
                        <div class="tooltip">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">${card.tooltip}</span>
                        </div>
                    </h3>
                    <div class="value">${card.value}</div>
                </div>
            `).join('');
        }

        function createCharts(results, tiers) {
            // Destroy existing charts
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            charts = {};

            const labels = results.Date;

            // Financial Overview Chart
            charts.financial = new Chart(document.getElementById('financial-chart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Total Revenue',
                            data: results.TotalRevenue,
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            fill: true
                        },
                        {
                            label: 'Total Expenses',
                            data: results.TotalExpenses,
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            fill: true
                        },
                        {
                            label: 'Net Cash Flow',
                            data: results.MonthlyCashFlow,
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Expense Breakdown Chart
            charts.expenses = new Chart(document.getElementById('expenses-chart'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Fixed Expenses',
                            data: results.FixedExpenses,
                            backgroundColor: '#6c757d'
                        },
                        {
                            label: 'Variable Costs (Flat Fee)',
                            data: results.FlatFee,
                            backgroundColor: '#ffc107'
                        },
                        {
                            label: 'Overage Costs',
                            data: results.OverageCosts,
                            backgroundColor: '#fd7e14'
                        },
                        {
                            label: 'CAC Costs',
                            data: results.CACCosts,
                            backgroundColor: '#e83e8c'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { stacked: true },
                        y: { 
                            stacked: true,
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Burn Rate Chart
            const cumulativeBurn = results.BurnRate.reduce((acc, burn, index) => {
                acc.push((acc[index - 1] || 0) + burn);
                return acc;
            }, []);

            charts.burnRate = new Chart(document.getElementById('burn-rate-chart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Monthly Burn Rate',
                            data: results.BurnRate,
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Cumulative Burn',
                            data: cumulativeBurn,
                            borderColor: '#6f42c1',
                            backgroundColor: 'rgba(111, 66, 193, 0.1)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Cash Flow with Funding Chart
            charts.cashFlow = new Chart(document.getElementById('cash-flow-chart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Monthly Cash Flow (Before Funding)',
                            data: results.MonthlyCashFlow,
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            fill: true
                        },
                        {
                            label: 'Cash Position (After Funding)',
                            data: results.CashPosition,
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Funding Chart
            charts.funding = new Chart(document.getElementById('funding-chart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Monthly Funding Drawdown',
                            data: results.FundingDrawdown,
                            borderColor: '#ffc107',
                            backgroundColor: 'rgba(255, 193, 7, 0.1)',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Remaining Funding',
                            data: results.RemainingFunding,
                            borderColor: '#17a2b8',
                            backgroundColor: 'rgba(23, 162, 184, 0.1)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Users Chart
            const userDatasets = tiers.map((tier, index) => {
                const colors = ['#007bff', '#28a745', '#ffc107', '#dc3545', '#6f42c1', '#fd7e14'];
                return {
                    label: `${tier.name} Users`,
                    data: results[`${tier.name}Users`],
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    fill: false
                };
            });

            charts.users = new Chart(document.getElementById('users-chart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: userDatasets
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + ' users';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Usage Chart
            charts.usage = new Chart(document.getElementById('usage-chart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Total Minutes Used',
                            data: results.TotalMinutesUsed,
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Overage Minutes',
                            data: results.OverageMinutes,
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + ' min';
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + ' min';
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toLocaleString() + ' minutes';
                                }
                            }
                        }
                    }
                }
            });

            // CAC Chart
            const cumulativeCAC = results.CACCosts.reduce((acc, cac, index) => {
                acc.push((acc[index - 1] || 0) + cac);
                return acc;
            }, []);

            charts.cac = new Chart(document.getElementById('cac-chart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Monthly CAC Spend',
                            data: results.CACCosts,
                            borderColor: '#e83e8c',
                            backgroundColor: 'rgba(232, 62, 140, 0.1)',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Cumulative CAC Investment',
                            data: cumulativeCAC,
                            borderColor: '#6f42c1',
                            backgroundColor: 'rgba(111, 66, 193, 0.1)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>