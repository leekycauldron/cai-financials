<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Projections</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .chart-container {
            width: 45%;
            margin: 20px;
            display: inline-block;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        .charts-wrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        h1, h2 {
            text-align: center;
            color: #333;
            margin: 20px 0;
        }
        .forms-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .form-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            position: relative;
        }
        .form-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 10px;
        }
        .input-group {
            flex: 1;
            min-width: 200px;
            position: relative;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        .expense-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .expense-item input {
            margin: 0;
        }
        .remove-btn {
            background-color: #ff4444;
            padding: 5px 10px;
            font-size: 12px;
        }
        .remove-btn:hover {
            background-color: #cc0000;
        }
        .add-expense-btn {
            background-color: #2196F3;
        }
        .add-expense-btn:hover {
            background-color: #1976D2;
        }
        .funding-summary {
            background: #e8f5e8;
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .funding-summary h3 {
            color: #2e7d32;
            margin-top: 0;
        }
        .funding-metric {
            display: inline-block;
            margin: 10px 20px 10px 0;
            padding: 10px 15px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #4CAF50;
        }
        .funding-metric strong {
            display: block;
            font-size: 1.2em;
            color: #333;
        }
        .funding-metric span {
            color: #666;
            font-size: 0.9em;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-left-color: #ff9800;
        }
        .warning h3 {
            color: #856404;
        }
        .warning .funding-metric {
            border-left-color: #ff9800;
        }
        .burn-rate-summary {
            background: #f3e5f5;
            border: 1px solid #9c27b0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .burn-rate-summary h3 {
            color: #6a1b9a;
            margin-top: 0;
        }
        .burn-rate-metric {
            display: inline-block;
            margin: 10px 20px 10px 0;
            padding: 10px 15px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #9c27b0;
        }
        .burn-rate-metric strong {
            display: block;
            font-size: 1.2em;
            color: #333;
        }
        .burn-rate-metric span {
            color: #666;
            font-size: 0.9em;
        }

        /* Tooltip Styles */
        .tooltip-trigger {
            display: inline-block;
            width: 18px;
            height: 18px;
            background-color: #2196F3;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            margin-left: 8px;
            position: relative;
            vertical-align: middle;
        }

        .tooltip-trigger:hover {
            background-color: #1976D2;
        }

        .tooltip {
            visibility: hidden;
            width: 300px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 12px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 13px;
            line-height: 1.4;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .tooltip-trigger:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        .label-with-tooltip {
            display: flex;
            align-items: center;
        }

        /* Responsive tooltip positioning */
        @media (max-width: 768px) {
            .tooltip {
                width: 250px;
                margin-left: -125px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Financial Projections Dashboard</h1>
        
        <div class="forms-container">
            <h2>Projection Parameters</h2>
            
            <!-- Subscription Tiers -->
            <div class="form-section">
                <div class="section-title">
                    <h3>Subscription Tiers</h3>
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            Define your different subscription plans. Each tier has its own pricing, user limits, and customer behavior patterns. The system tracks how users grow, churn, and use your service across all tiers.
                        </div>
                    </div>
                </div>
                
                <!-- Acquaintance Tier -->
                <div class="form-group">
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Acquaintance - Minute Quota</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The maximum number of minutes included in this subscription tier each month. Users who exceed this will generate overage charges.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="acquaintance-quota" value="5">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Price per Month ($)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The monthly subscription fee charged to each user in this tier. This is your primary recurring revenue source.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="acquaintance-price" value="10">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Initial Users</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The number of paying subscribers you start with in this tier at the beginning of your projection period.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="acquaintance-users" value="100">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Monthly Churn Rate (%)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The percentage of users who cancel their subscription each month. Lower churn rates indicate better customer retention and more predictable revenue.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="acquaintance-churn" value="5" step="0.1">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Monthly Growth Rate (%)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The percentage of new users you acquire each month relative to your current user base. This represents your organic and paid acquisition efforts.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="acquaintance-growth" value="10" step="0.1">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Usage Rate (%)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The percentage of their allocated minutes that users actually consume on average. Not all users will use their full quota every month.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="acquaintance-usage" value="75" step="1">
                    </div>
                </div>

                <!-- Friend Tier -->
                <div class="form-group">
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Friend - Minute Quota</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The maximum number of minutes included in this subscription tier each month. Users who exceed this will generate overage charges.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="friend-quota" value="15">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Price per Month ($)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The monthly subscription fee charged to each user in this tier. This is your primary recurring revenue source.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="friend-price" value="40">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Initial Users</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The number of paying subscribers you start with in this tier at the beginning of your projection period.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="friend-users" value="75">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Monthly Churn Rate (%)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The percentage of users who cancel their subscription each month. Lower churn rates indicate better customer retention and more predictable revenue.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="friend-churn" value="3.5" step="0.1">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Monthly Growth Rate (%)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The percentage of new users you acquire each month relative to your current user base. This represents your organic and paid acquisition efforts.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="friend-growth" value="6.5" step="0.1">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Usage Rate (%)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The percentage of their allocated minutes that users actually consume on average. Not all users will use their full quota every month.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="friend-usage" value="85" step="1">
                    </div>
                </div>

                <!-- Best Friend Tier -->
                <div class="form-group">
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Best Friend - Minute Quota</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The maximum number of minutes included in this subscription tier each month. Users who exceed this will generate overage charges.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="bestfriend-quota" value="30">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Price per Month ($)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The monthly subscription fee charged to each user in this tier. This is your primary recurring revenue source.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="bestfriend-price" value="70">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Initial Users</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The number of paying subscribers you start with in this tier at the beginning of your projection period.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="bestfriend-users" value="50">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Monthly Churn Rate (%)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The percentage of users who cancel their subscription each month. Lower churn rates indicate better customer retention and more predictable revenue.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="bestfriend-churn" value="3" step="0.1">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Monthly Growth Rate (%)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The percentage of new users you acquire each month relative to your current user base. This represents your organic and paid acquisition efforts.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="bestfriend-growth" value="5" step="0.1">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Usage Rate (%)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The percentage of their allocated minutes that users actually consume on average. Not all users will use their full quota every month.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="bestfriend-usage" value="90" step="1">
                    </div>
                </div>
            </div>

            <!-- Customer Acquisition Cost -->
            <div class="form-section">
                <div class="section-title">
                    <h3>Customer Acquisition Cost (CAC)</h3>
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            CAC represents how much you spend on marketing, sales, and other activities to acquire each new paying customer. This includes advertising costs, sales team salaries, marketing tools, and promotional expenses.
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Average CAC per New User ($)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The average cost to acquire one new paying customer across all channels and tiers. This cost is applied each time you gain a new subscriber.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="cac-per-user" value="25" step="0.01">
                    </div>
                </div>
                <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                    This cost will be applied for each new user acquired across all subscription tiers.
                </p>
            </div>

            <!-- Variable Costs Structure -->
            <div class="form-section">
                <div class="section-title">
                    <h3>Variable Cost Structure</h3>
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            These are costs that change based on your service usage. Many SaaS businesses have third-party service costs that scale with usage, like API calls, cloud computing, or communication services.
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Monthly Flat Fee ($)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    A fixed monthly cost you pay to your service provider regardless of usage. This might be a base plan fee for APIs, cloud services, or communication platforms.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="flat-fee" value="1100">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Included Minutes</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The number of minutes included in your flat fee. Once your total usage exceeds this amount, you'll pay overage charges.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="included-minutes" value="1100">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Overage Cost per Minute ($)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The additional cost charged for each minute of usage beyond your included minutes. This creates variable costs that scale with your business growth.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="overage-cost" value="0.11" step="0.01">
                    </div>
                </div>
            </div>

            <!-- Monthly Fixed Expenses -->
            <div class="form-section">
                <div class="section-title">
                    <h3>Monthly Fixed Expenses</h3>
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            These are recurring costs that remain relatively constant each month regardless of your user count or usage. Examples include salaries, rent, insurance, software subscriptions, and marketing budgets.
                        </div>
                    </div>
                </div>
                <div id="expenses-container">
                    <div class="expense-item">
                        <div class="input-group">
                            <label>Expense Name</label>
                            <input type="text" value="Advertising" class="expense-name">
                        </div>
                        <div class="input-group">
                            <label>Monthly Cost ($)</label>
                            <input type="number" value="5000" class="expense-cost">
                        </div>
                        <button type="button" class="remove-btn" onclick="removeExpense(this)">Remove</button>
                    </div>
                    <div class="expense-item">
                        <div class="input-group">
                            <label>Expense Name</label>
                            <input type="text" value="Salaries" class="expense-name">
                        </div>
                        <div class="input-group">
                            <label>Monthly Cost ($)</label>
                            <input type="number" value="15000" class="expense-cost">
                        </div>
                        <button type="button" class="remove-btn" onclick="removeExpense(this)">Remove</button>
                    </div>
                    <div class="expense-item">
                        <div class="input-group">
                            <label>Expense Name</label>
                            <input type="text" value="Office Lease" class="expense-name">
                        </div>
                        <div class="input-group">
                            <label>Monthly Cost ($)</label>
                            <input type="number" value="3000" class="expense-cost">
                        </div>
                        <button type="button" class="remove-btn" onclick="removeExpense(this)">Remove</button>
                    </div>
                </div>
                <button type="button" class="add-expense-btn" onclick="addExpense()">Add New Expense</button>
            </div>

            <!-- One-Time Startup Costs -->
            <div class="form-section">
                <div class="section-title">
                    <h3>One-Time Startup Costs</h3>
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            Initial expenses required to start your business that won't recur monthly. These are deducted from your available funding at the beginning of the projection period.
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Initial Legal & Setup Costs ($)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    One-time costs like legal fees, business registration, initial equipment purchases, website development, or other setup expenses needed to launch your business.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="startup-costs" value="10000">
                    </div>
                </div>
                <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                    These are one-time costs incurred at the beginning (legal fees, initial licenses, equipment, etc.)
                </p>
            </div>

            <!-- Available Funding & Projection Period -->
            <div class="form-section">
                <div class="section-title">
                    <h3>Available Funding & Projection Period</h3>
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            Set your total available capital and the timeframe for your financial projections. The system will track when you might run out of funding and when you might reach profitability.
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Available Funding ($)</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    Total capital available to cover losses and fund operations. This could be from personal savings, investors, loans, or other funding sources.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="available-funding" value="50000">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Start Date</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    The beginning date for your financial projections. This helps with planning and tracking your business timeline.
                                </div>
                            </div>
                        </div>
                        <input type="date" id="start-date" value="2025-09-01">
                    </div>
                    <div class="input-group">
                        <div class="label-with-tooltip">
                            <label>Number of Months</label>
                            <div class="tooltip-trigger">?
                                <div class="tooltip">
                                    How many months into the future to project. Longer periods help with strategic planning but become less accurate over time.
                                </div>
                            </div>
                        </div>
                        <input type="number" id="num-months" value="24" min="1" max="60">
                    </div>
                </div>
            </div>

            <button onclick="updateProjections()">Update Projections</button>
        </div>

        <!-- Burn Rate Summary -->
        <div class="burn-rate-summary" id="burn-rate-summary" style="display: none;">
            <div class="section-title">
                <h3>🔥 Burn Rate Analysis</h3>
                <div class="tooltip-trigger">?
                    <div class="tooltip">
                        Burn rate shows how much money you're losing each month. A positive burn rate means you're spending more than you earn. The goal is to reduce burn rate to zero (break-even) and eventually become profitable.
                    </div>
                </div>
            </div>
            <div id="burn-rate-metrics"></div>
        </div>

        <!-- Funding Summary -->
        <div class="funding-summary" id="funding-summary" style="display: none;">
            <div class="section-title">
                <h3>💰 Funding Analysis</h3>
                <div class="tooltip-trigger">?
                    <div class="tooltip">
                        This tracks how your available funding is used over time to cover losses. It shows when you might run out of money and helps you plan for additional funding rounds or profitability milestones.
                    </div>
                </div>
            </div>
            <div id="funding-metrics"></div>
        </div>

        <div class="charts-wrapper">
            <div class="chart-container">
                <div class="chart-title">
                    Overall Financial Metrics
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            This chart shows your core financial performance over time. Revenue is money coming in from subscriptions, Total Expenses includes all costs, and Monthly Cash Flow shows your net profit/loss each month.
                        </div>
                    </div>
                </div>
                <canvas id="financialMetrics"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">
                    Expense Breakdown
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            Shows how your different expense categories change over time. Fixed Expenses stay constant, Flat Fee is your base service cost, Overage Costs increase with usage, and CAC Costs depend on new user acquisition.
                        </div>
                    </div>
                </div>
                <canvas id="expenseBreakdown"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">
                    Monthly Burn Rate Analysis
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            Burn rate is how much money you lose each month (expenses minus revenue). Values above the break-even line mean you're losing money. The goal is to get below the line and stay there.
                        </div>
                    </div>
                </div>
                <canvas id="burnRateChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">
                    Cash Flow Analysis with Funding Support
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            Shows your cash flow before and after using funding to cover losses. The red area shows losses, while the green line shows your actual cash position after drawing from available funding.
                        </div>
                    </div>
                </div>
                <canvas id="cashFlowChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">
                    Funding Drawdown & Remaining Balance
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            The bars show how much funding you use each month to cover losses. The line shows how much funding remains. When the line reaches zero, you've exhausted your available capital.
                        </div>
                    </div>
                </div>
                <canvas id="fundingChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">
                    User Count by Tier
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            Tracks how your subscriber base grows in each pricing tier over time. This helps you understand which tiers are most popular and how your customer base is evolving.
                        </div>
                    </div>
                </div>
                <canvas id="userCounts"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">
                    Minutes Usage and Overages
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            Shows total minutes used by all customers vs. your included minutes threshold. When usage exceeds the threshold, you pay overage charges. This helps predict variable costs.
                        </div>
                    </div>
                </div>
                <canvas id="minutesUsage"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">
                    Customer Acquisition Cost Analysis
                    <div class="tooltip-trigger">?
                        <div class="tooltip">
                            The bars show new users acquired each month, while the line shows the total cost of acquiring those users. This helps you understand the relationship between growth and acquisition spending.
                        </div>
                    </div>
                </div>
                <canvas id="cacChart"></canvas>
            </div>
        </div>
    </div>

    <script type="module">
        import { VariableCostStructure, SubscriptionTier, FinancialProjection } from './financial_projections.js';

        let charts = {
            financialMetrics: null,
            expenseBreakdown: null,
            burnRateChart: null,
            cashFlowChart: null,
            fundingChart: null,
            userCounts: null,
            minutesUsage: null,
            cacChart: null
        };

        function getInputValue(id) {
            return document.getElementById(id).value;
        }

        function createSubscriptionTier(prefix) {
            return new SubscriptionTier(
                prefix,
                Number(getInputValue(`${prefix.toLowerCase()}-quota`)),
                Number(getInputValue(`${prefix.toLowerCase()}-price`)),
                Number(getInputValue(`${prefix.toLowerCase()}-users`)),
                Number(getInputValue(`${prefix.toLowerCase()}-churn`)) / 100,
                Number(getInputValue(`${prefix.toLowerCase()}-growth`)) / 100,
                Number(getInputValue(`${prefix.toLowerCase()}-usage`)) / 100
            );
        }

        function getExpenses() {
            const expenses = {};
            const expenseItems = document.querySelectorAll('.expense-item');
            
            expenseItems.forEach(item => {
                const name = item.querySelector('.expense-name').value.trim();
                const cost = Number(item.querySelector('.expense-cost').value);
                if (name && cost >= 0) {
                    expenses[name] = cost;
                }
            });
            
            return expenses;
        }

        window.addExpense = function() {
            const container = document.getElementById('expenses-container');
            const expenseItem = document.createElement('div');
            expenseItem.className = 'expense-item';
            expenseItem.innerHTML = `
                <div class="input-group">
                    <label>Expense Name</label>
                    <input type="text" placeholder="Enter expense name" class="expense-name">
                </div>
                <div class="input-group">
                    <label>Monthly Cost ($)</label>
                    <input type="number" value="0" class="expense-cost">
                </div>
                <button type="button" class="remove-btn" onclick="removeExpense(this)">Remove</button>
            `;
            container.appendChild(expenseItem);
        };

        window.removeExpense = function(button) {
            const expenseItem = button.parentElement;
            expenseItem.remove();
        };

        function updateBurnRateSummary(results) {
            const summaryDiv = document.getElementById('burn-rate-summary');
            const metricsDiv = document.getElementById('burn-rate-metrics');
            
            // Calculate burn rate metrics
            const avgBurnRate = results.BurnRate.reduce((sum, val) => sum + val, 0) / results.BurnRate.length;
            const maxBurnRate = Math.max(...results.BurnRate);
            const minBurnRate = Math.min(...results.BurnRate);
            const finalBurnRate = results.BurnRate[results.BurnRate.length - 1];
            
            // Find when burn rate becomes positive (if ever)
            const positiveMonths = results.BurnRate.filter(rate => rate > 0).length;
            const firstPositiveMonth = results.BurnRate.findIndex(rate => rate > 0) + 1;
            
            let metricsHTML = `
                <div class="burn-rate-metric">
                    <strong>$${avgBurnRate.toLocaleString()}</strong>
                    <span>Average Monthly Burn Rate</span>
                </div>
                <div class="burn-rate-metric">
                    <strong>$${maxBurnRate.toLocaleString()}</strong>
                    <span>Peak Monthly Burn Rate</span>
                </div>
                <div class="burn-rate-metric">
                    <strong>$${finalBurnRate.toLocaleString()}</strong>
                    <span>Final Month Burn Rate</span>
                </div>
            `;
            
            if (firstPositiveMonth > 0) {
                metricsHTML += `
                    <div class="burn-rate-metric">
                        <strong>Month ${firstPositiveMonth}</strong>
                        <span>First Positive Cash Flow</span>
                    </div>
                `;
            }
            
            metricsHTML += `
                <div class="burn-rate-metric">
                    <strong>${positiveMonths} months</strong>
                    <span>Months with Positive Cash Flow</span>
                </div>
            `;
            
            metricsDiv.innerHTML = metricsHTML;
            summaryDiv.style.display = 'block';
        }

        function updateFundingSummary(results) {
            const summaryDiv = document.getElementById('funding-summary');
            const metricsDiv = document.getElementById('funding-metrics');
            
            // Calculate key metrics
            const totalFundingUsed = results.FundingDrawdown.reduce((sum, val) => sum + val, 0);
            const finalRemainingFunding = results.RemainingFunding[results.RemainingFunding.length - 1];
            const breakEvenMonth = results.BreakEvenMonth;
            const fundingExhausted = results.FundingExhausted;
            const fundingExhaustedMonth = results.FundingExhaustedMonth;
            
            // Find peak monthly drawdown
            const maxMonthlyDrawdown = Math.max(...results.FundingDrawdown);
            const maxDrawdownMonth = results.FundingDrawdown.indexOf(maxMonthlyDrawdown) + 1;
            
            // Determine if this is a warning scenario
            const isWarning = fundingExhausted || (!breakEvenMonth && finalRemainingFunding < 10000);
            
            if (isWarning) {
                summaryDiv.className = 'funding-summary warning';
            } else {
                summaryDiv.className = 'funding-summary';
            }
            
            let metricsHTML = `
                <div class="funding-metric">
                    <strong>$${totalFundingUsed.toLocaleString()}</strong>
                    <span>Total Funding Used</span>
                </div>
                <div class="funding-metric">
                    <strong>$${finalRemainingFunding.toLocaleString()}</strong>
                    <span>Remaining Funding</span>
                </div>
                <div class="funding-metric">
                    <strong>$${maxMonthlyDrawdown.toLocaleString()}</strong>
                    <span>Peak Monthly Drawdown (Month ${maxDrawdownMonth})</span>
                </div>
            `;
            
            if (breakEvenMonth) {
                metricsHTML += `
                    <div class="funding-metric">
                        <strong>Month ${breakEvenMonth}</strong>
                        <span>Break-Even Point</span>
                    </div>
                `;
            } else {
                metricsHTML += `
                    <div class="funding-metric">
                        <strong>Not Reached</strong>
                        <span>Break-Even Point</span>
                    </div>
                `;
            }
            
            if (fundingExhausted) {
                metricsHTML += `
                    <div class="funding-metric">
                        <strong>Month ${fundingExhaustedMonth}</strong>
                        <span>⚠️ Funding Exhausted</span>
                    </div>
                `;
            }
            
            metricsDiv.innerHTML = metricsHTML;
            summaryDiv.style.display = 'block';
        }

        function createCharts(results, variableCosts) {
            // Destroy existing charts
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });

            // Financial Metrics Chart
            const ctxFinancial = document.getElementById('financialMetrics').getContext('2d');
            charts.financialMetrics = new Chart(ctxFinancial, {
                type: 'line',
                data: {
                    labels: results.Date,
                    datasets: [{
                        label: 'Revenue',
                        data: results.TotalRevenue,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }, {
                        label: 'Total Expenses',
                        data: results.TotalExpenses,
                        borderColor: 'rgb(255, 99, 132)',
                        tension: 0.1
                    }, {
                        label: 'Monthly Cash Flow',
                        data: results.MonthlyCashFlow,
                        borderColor: 'rgb(54, 162, 235)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: false
                        }
                    }
                }
            });

            // Expense Breakdown Chart
            const ctxExpense = document.getElementById('expenseBreakdown').getContext('2d');
            charts.expenseBreakdown = new Chart(ctxExpense, {
                type: 'line',
                data: {
                    labels: results.Date,
                    datasets: [{
                        label: 'Fixed Expenses',
                        data: results.FixedExpenses,
                        borderColor: 'rgb(153, 102, 255)',
                        tension: 0.1
                    }, {
                        label: 'Flat Fee',
                        data: results.FlatFee,
                        borderColor: 'rgb(255, 159, 64)',
                        tension: 0.1
                    }, {
                        label: 'Overage Costs',
                        data: results.OverageCosts,
                        borderColor: 'rgb(255, 205, 86)',
                        tension: 0.1
                    }, {
                        label: 'CAC Costs',
                        data: results.CACCosts,
                        borderColor: 'rgb(255, 99, 132)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: false
                        }
                    }
                }
            });

            // Burn Rate Chart
            const ctxBurnRate = document.getElementById('burnRateChart').getContext('2d');
            charts.burnRateChart = new Chart(ctxBurnRate, {
                type: 'line',
                data: {
                    labels: results.Date,
                    datasets: [{
                        label: 'Monthly Burn Rate',
                        data: results.BurnRate,
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        tension: 0.1,
                        fill: true
                    }, {
                        label: 'Break-Even Line',
                        data: new Array(results.Date.length).fill(0),
                        borderColor: 'rgb(54, 162, 235)',
                        borderDash: [5, 5],
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Burn Rate ($)'
                            }
                        }
                    }
                }
            });

            // Cash Flow Chart with Funding
            const ctxCashFlow = document.getElementById('cashFlowChart').getContext('2d');
            charts.cashFlowChart = new Chart(ctxCashFlow, {
                type: 'line',
                data: {
                    labels: results.Date,
                    datasets: [{
                        label: 'Monthly Cash Flow (Before Funding)',
                        data: results.MonthlyCashFlow,
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        tension: 0.1,
                        fill: true
                    }, {
                        label: 'Cash Position (After Funding)',
                        data: results.CashPosition,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }, {
                        label: 'Break-Even Line',
                        data: new Array(results.Date.length).fill(0),
                        borderColor: 'rgb(54, 162, 235)',
                        borderDash: [5, 5],
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: false
                        }
                    }
                }
            });

            // Funding Drawdown Chart
            const ctxFunding = document.getElementById('fundingChart').getContext('2d');
            charts.fundingChart = new Chart(ctxFunding, {
                type: 'bar',
                data: {
                    labels: results.Date,
                    datasets: [{
                        label: 'Monthly Funding Drawdown',
                        data: results.FundingDrawdown,
                        backgroundColor: 'rgba(255, 159, 64, 0.6)',
                        borderColor: 'rgb(255, 159, 64)',
                        borderWidth: 1,
                        yAxisID: 'y'
                    }, {
                        label: 'Remaining Funding',
                        data: results.RemainingFunding,
                        type: 'line',
                        borderColor: 'rgb(54, 162, 235)',
                        tension: 0.1,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Monthly Drawdown ($)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Remaining Funding ($)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });

            // User Counts Chart
            const ctxUsers = document.getElementById('userCounts').getContext('2d');
            charts.userCounts = new Chart(ctxUsers, {
                type: 'line',
                data: {
                    labels: results.Date,
                    datasets: [{
                        label: 'Acquaintance Users',
                        data: results.AcquaintanceUsers,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }, {
                        label: 'Friend Users',
                        data: results.FriendUsers,
                        borderColor: 'rgb(255, 99, 132)',
                        tension: 0.1
                    }, {
                        label: 'Best Friend Users',
                        data: results.BestFriendUsers,
                        borderColor: 'rgb(54, 162, 235)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: false
                        }
                    }
                }
            });

            // Minutes Usage Chart
            const ctxMinutes = document.getElementById('minutesUsage').getContext('2d');
            charts.minutesUsage = new Chart(ctxMinutes, {
                type: 'line',
                data: {
                    labels: results.Date,
                    datasets: [{
                        label: 'Total Minutes Used',
                        data: results.TotalMinutesUsed,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }, {
                        label: 'Included Minutes Threshold',
                        data: new Array(results.Date.length).fill(variableCosts.includedMinutes),
                        borderColor: 'rgb(255, 99, 132)',
                        borderDash: [5, 5],
                        tension: 0.1
                    }, {
                        label: 'Overage Minutes',
                        data: results.OverageMinutes,
                        borderColor: 'rgb(255, 159, 64)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: false
                        }
                    }
                }
            });

            // CAC Chart
            const ctxCAC = document.getElementById('cacChart').getContext('2d');
            charts.cacChart = new Chart(ctxCAC, {
                type: 'bar',
                data: {
                    labels: results.Date,
                    datasets: [{
                        label: 'New Users Acquired',
                        data: results.NewUsersAcquired,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgb(75, 192, 192)',
                        borderWidth: 1,
                        yAxisID: 'y'
                    }, {
                        label: 'CAC Costs',
                        data: results.CACCosts,
                        type: 'line',
                        borderColor: 'rgb(255, 99, 132)',
                        tension: 0.1,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'New Users'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'CAC Costs ($)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        window.updateProjections = function() {
            // Create subscription tiers from form inputs
            const basicTier = createSubscriptionTier('Acquaintance');
            const premiumTier = createSubscriptionTier('Friend');
            const ultraTier = createSubscriptionTier('BestFriend');

            // Create variable costs structure
            const variableCosts = new VariableCostStructure(
                Number(getInputValue('flat-fee')),
                Number(getInputValue('included-minutes')),
                Number(getInputValue('overage-cost'))
            );

            // Get monthly fixed expenses from dynamic form
            const monthlyFixedExpenses = getExpenses();

            // Create projection model
            const projection = new FinancialProjection(
                [basicTier, premiumTier, ultraTier],
                monthlyFixedExpenses,
                variableCosts,
                getInputValue('start-date'),
                Number(getInputValue('num-months')),
                Number(getInputValue('available-funding')),
                Number(getInputValue('cac-per-user')),
                Number(getInputValue('startup-costs'))
            );

            // Calculate and update charts
            const results = projection.calculateProjections();
            createCharts(results, variableCosts);
            updateBurnRateSummary(results);
            updateFundingSummary(results);
        };

        // Initial chart creation
        updateProjections();
    </script>
</body>
</html>